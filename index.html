<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Registros de Alumnos</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #ecf0f1;
      margin: 0;
      padding: 20px;
    }
    h1 {
      text-align: center;
      color: #2c3e50;
    }
    form, .login, .accionesGlobales, .accionesSeleccion {
      background: #fff;
      padding: 20px;
      border-radius: 10px;
      width: 80%;
      margin: 20px auto;
      box-shadow: 0px 4px 6px rgba(0,0,0,0.1);
    }
    label {
      font-weight: bold;
      display: block;
      margin-top: 10px;
    }
    input, textarea, button {
      width: 100%;
      margin: 5px 0;
      padding: 8px;
      border: 1px solid #ccc;
      border-radius: 5px;
    }
    button {
      background: #27ae60;
      color: white;
      font-weight: bold;
      cursor: pointer;
    }
    button:hover {
      background: yellow;
      color: black;
    }
    table {
      width: 90%;
      margin: 10px auto 30px auto;
      border-collapse: collapse;
      background: white;
      border-radius: 10px;
    }
    th, td {
      border: 1px solid #ddd;
      padding: 10px;
      text-align: center;
    }
    th {
      background-color: #34495e;
      color: white;
    }
    .acciones button {
      background: red;
      color: white;
      border: none;
      padding: 5px 10px;
      border-radius: 5px;
      margin: 2px;
    }
    .acciones .editar {
      background: #2980b9;
    }
    .seleccion {
      width: 20px;
      height: 20px;
    }
  </style>
</head>
<body>

<div class="login" id="loginDiv">
  <h2>Iniciar Sesi√≥n</h2>
  <input type="text" id="usuario" placeholder="Usuario">
  <input type="password" id="clave" placeholder="Contrase√±a">
  <button onclick="login()">Entrar</button>
</div>

<div id="contenido" style="display:none;">
  <h1>Registro de Alumnos</h1>

  <form id="formAlumno">
    <input type="text" id="gradoGrupo" placeholder="Grado y Grupo (ej. 6A)" required>
    <input type="text" id="nombre" placeholder="Nombre(s)" required>
    <input type="text" id="paterno" placeholder="Apellido Paterno" required>
    <input type="text" id="materno" placeholder="Apellido Materno" required>
    <textarea id="fortalezas" placeholder="Fortalezas"></textarea>
    <textarea id="oportunidades" placeholder="Oportunidades"></textarea>
    <textarea id="areas" placeholder="√Åreas a mejorar"></textarea>
    <textarea id="comportamiento" placeholder="Comportamiento"></textarea>
    <button type="submit">Agregar Alumno</button>
  </form>

  <div class="accionesGlobales">
    <input type="text" id="buscar" placeholder="Buscar">
    <button onclick="buscarAlumno()">Buscar</button>

    <input type="text" id="grupoCambiar" placeholder="Grupo a modificar">
    <input type="text" id="nuevoGrupo" placeholder="Nuevo grupo">
    <button onclick="cambiarGrupo()">Cambiar Grupo</button>

    <input type="text" id="grupoEliminar" placeholder="Grupo a eliminar">
    <button onclick="eliminarGrupo()">Eliminar Grupo</button>

    <h4>Maestro asignado por grupo</h4>
    <input type="text" id="grupoMaestro" placeholder="Grupo (ej. 6A)">
    <input type="text" id="nombreMaestro" placeholder="Nombre del maestro">
    <button onclick="guardarMaestro()">Guardar / Cambiar Maestro</button>

    <h4>Cambiar Usuario y Contrase√±a</h4>
    <input type="text" id="nuevoUsuario" placeholder="Nuevo Usuario">
    <input type="password" id="nuevaClave" placeholder="Nueva Contrase√±a">
    <button onclick="cambiarCredenciales()">Guardar Cambios</button>
  </div>

  <div id="lista"></div>
</div>

<!-- MODAL EDITAR (MEJORADO, TODO LO DEM√ÅS ORIGINAL) -->
<div id="modalEditar" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.6); overflow:auto;">
  <div style="background:#fff; width:50%; margin:5% auto; padding:20px; border-radius:10px;">

    <!-- BOTONES ARRIBA -->
    <button onclick="guardarEdicion()">üíæ Guardar Cambios</button>
    <button onclick="cerrarModal()">‚ùå Cancelar</button>

    <h3>Editar Alumno</h3>

    <input type="hidden" id="editId">

    <label>Grupo</label>
    <input type="text" id="editGrupo">

    <label>Nombre(s)</label>
    <input type="text" id="editNombre">

    <label>Apellido Paterno</label>
    <input type="text" id="editPaterno">

    <label>Apellido Materno</label>
    <input type="text" id="editMaterno">

    <label>Fortalezas</label>
    <textarea id="editFortalezas"></textarea>

    <label>Oportunidades</label>
    <textarea id="editOportunidades"></textarea>

    <label>√Åreas a mejorar</label>
    <textarea id="editAreas"></textarea>

    <label>Comportamiento</label>
    <textarea id="editComportamiento"></textarea>
  </div>
</div>

<script>
/* CREDENCIALES */
if (!localStorage.getItem("usuario")) {
  localStorage.setItem("usuario", "oct2025");
  localStorage.setItem("clave", "Alumnos2025");
}

function login() {
  if (usuario.value === "Padres2025" && clave.value === "pap*s2025") {
    window.location.href = "Consulta.html";
    return;
  }
  if (usuario.value === localStorage.getItem("usuario") &&
      clave.value === localStorage.getItem("clave")) {
    loginDiv.style.display = "none";
    contenido.style.display = "block";
    mostrarAlumnos();
  } else {
    alert("Usuario o contrase√±a incorrectos");
  }
}

/* ALUMNOS */
formAlumno.addEventListener("submit", e => {
  e.preventDefault();
  let alumnos = JSON.parse(localStorage.getItem("alumnos")) || [];
  let id = alumnos.length ? alumnos[alumnos.length - 1].id + 1 : 1;

  alumnos.push({
    id,
    gradoGrupo: gradoGrupo.value,
    nombre: nombre.value,
    paterno: paterno.value,
    materno: materno.value,
    fortalezas: fortalezas.value,
    oportunidades: oportunidades.value,
    areas: areas.value,
    comportamiento: comportamiento.value
  });

  localStorage.setItem("alumnos", JSON.stringify(alumnos));
  formAlumno.reset();
  mostrarAlumnos();
});

/* MOSTRAR AGRUPADO */
function mostrarAlumnos(filtro="") {
  let alumnos = JSON.parse(localStorage.getItem("alumnos")) || [];
  let maestros = JSON.parse(localStorage.getItem("maestros")) || {};

  if (filtro) {
    alumnos = alumnos.filter(a =>
      a.nombre.toLowerCase().includes(filtro.toLowerCase()) ||
      a.paterno.toLowerCase().includes(filtro.toLowerCase()) ||
      a.materno.toLowerCase().includes(filtro.toLowerCase()) ||
      a.gradoGrupo.toLowerCase().includes(filtro.toLowerCase())
    );
  }

  const grupos = {};
  alumnos.forEach(a => {
    if (!grupos[a.gradoGrupo]) grupos[a.gradoGrupo] = [];
    grupos[a.gradoGrupo].push(a);
  });

  lista.innerHTML = "";

  for (let grupo in grupos) {
    let maestro = maestros[grupo] || "No asignado";

    let html = `
      <h3>Grupo ${grupo} ‚Äî Maestro: ${maestro}</h3>
      <table>
        <tr>
          <th>No.</th>
          <th>Nombre</th>
          <th>Paterno</th>
          <th>Materno</th>
          <th>Acciones</th>
        </tr>
    `;

    grupos[grupo].forEach(a => {
      html += `
        <tr>
          <td>${a.id}</td>
          <td>${a.nombre}</td>
          <td>${a.paterno}</td>
          <td>${a.materno}</td>
          <td class="acciones">
            <button onclick="eliminar(${a.id})">Eliminar</button>
            <button class="editar" onclick="editarAlumno(${a.id})">Editar</button>
          </td>
        </tr>`;
    });

    html += "</table>";
    lista.innerHTML += html;
  }
}

/* MAESTRO */
function guardarMaestro() {
  let maestros = JSON.parse(localStorage.getItem("maestros")) || {};
  maestros[grupoMaestro.value.toUpperCase()] = nombreMaestro.value;
  localStorage.setItem("maestros", JSON.stringify(maestros));
  mostrarAlumnos();
}

/* CAMBIAR GRUPO */
function cambiarGrupo() {
  let alumnos = JSON.parse(localStorage.getItem("alumnos")) || [];
  let maestros = JSON.parse(localStorage.getItem("maestros")) || {};

  alumnos.forEach(a => {
    if (a.gradoGrupo.toLowerCase() === grupoCambiar.value.toLowerCase()) {
      a.gradoGrupo = nuevoGrupo.value;
    }
  });

  if (maestros[grupoCambiar.value]) {
    maestros[nuevoGrupo.value] = maestros[grupoCambiar.value];
    delete maestros[grupoCambiar.value];
  }

  localStorage.setItem("alumnos", JSON.stringify(alumnos));
  localStorage.setItem("maestros", JSON.stringify(maestros));
  mostrarAlumnos();
}

/* ELIMINAR */
function eliminar(id) {
  let alumnos = JSON.parse(localStorage.getItem("alumnos")) || [];
  alumnos = alumnos.filter(a => a.id !== id);
  localStorage.setItem("alumnos", JSON.stringify(alumnos));
  mostrarAlumnos();
}

function eliminarGrupo() {
  let alumnos = JSON.parse(localStorage.getItem("alumnos")) || [];
  let maestros = JSON.parse(localStorage.getItem("maestros")) || {};
  let grupo = grupoEliminar.value.toLowerCase();

  alumnos = alumnos.filter(a => a.gradoGrupo.toLowerCase() !== grupo);
  Object.keys(maestros).forEach(g => {
    if (g.toLowerCase() === grupo) delete maestros[g];
  });

  localStorage.setItem("alumnos", JSON.stringify(alumnos));
  localStorage.setItem("maestros", JSON.stringify(maestros));
  mostrarAlumnos();
}

function buscarAlumno() {
  mostrarAlumnos(buscar.value);
}

function cambiarCredenciales() {
  if (nuevoUsuario.value && nuevaClave.value) {
    localStorage.setItem("usuario", nuevoUsuario.value);
    localStorage.setItem("clave", nuevaClave.value);
    alert("Credenciales actualizadas");
  }
}

/* EDITAR */
function editarAlumno(id) {
  let alumnos = JSON.parse(localStorage.getItem("alumnos")) || [];
  let a = alumnos.find(x => x.id === id);

  editId.value = a.id;
  editGrupo.value = a.gradoGrupo;
  editNombre.value = a.nombre;
  editPaterno.value = a.paterno;
  editMaterno.value = a.materno;
  editFortalezas.value = a.fortalezas;
  editOportunidades.value = a.oportunidades;
  editAreas.value = a.areas;
  editComportamiento.value = a.comportamiento;

  modalEditar.style.display = "block";
}

function guardarEdicion() {
  let alumnos = JSON.parse(localStorage.getItem("alumnos")) || [];
  let i = alumnos.findIndex(a => a.id == editId.value);

  alumnos[i] = {
    id: alumnos[i].id,
    gradoGrupo: editGrupo.value,
    nombre: editNombre.value,
    paterno: editPaterno.value,
    materno: editMaterno.value,
    fortalezas: editFortalezas.value,
    oportunidades: editOportunidades.value,
    areas: editAreas.value,
    comportamiento: editComportamiento.value
  };

  localStorage.setItem("alumnos", JSON.stringify(alumnos));
  cerrarModal();
  mostrarAlumnos();
}

function cerrarModal() {
  modalEditar.style.display = "none";
}
</script>

</body>
</html>
