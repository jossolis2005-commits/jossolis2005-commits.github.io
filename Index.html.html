<!DOCTYPE HTML>
<html lang="es">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Mexibotanas</title>
<style>
body { font-family: Arial; margin:0; padding:0; background:#ccc;}
header {background:#00FA9A; color:white; padding:1em; text-align:center;}
header img {width:150px; height:auto; display:block; margin:0 auto 10px auto;}
nav {background:#444; color:white; padding:10px 0; text-align:center;}
nav ul {list-style:none; margin:0; padding:0;}
nav ul li {display:inline; margin:0 15px;}
nav ul li a {color:white; text-decoration:none; transition:0.3s;}
nav ul li a:hover {color:yellow;}
section {padding:20px; margin:20px; background:white; border-radius:5px;}
.producto {display:inline-block; width:180px; margin:10px; padding:10px; background:#f4f4f4; border-radius:5px; text-align:center;}
.producto img {width:120px; height:120px;}
.producto input[type=number] {text-align:center; width:60px;}
button {background:#25D366; border:none; color:white; padding:6px 12px; margin-top:6px; cursor:pointer; border-radius:5px;}
button:hover {background:#1da851;}
#carrito {margin-top:20px; padding:10px; background:#fff; border-radius:5px;}
#carrito table {width:100%; border-collapse:collapse;}
#carrito th, #carrito td {border:1px solid #888; padding:6px; text-align:center;}
#carrito th {background:#444; color:white;}
#form-cliente {display:block; padding:15px; background:#fff; border-radius:5px; margin-top:20px;}
#form-cliente label {display:block; margin-top:10px; font-weight:bold;}
#form-cliente input {display:block; margin:5px 0 10px 0; padding:6px; width:95%; border:1px solid #888; border-radius:5px;}
footer {text-align:center; padding:1em; background:#000; color:white;}
#whatsapp {position: fixed; bottom: 20px; right: 20px; background: #25D366; color: white; border-radius: 50%; width: 60px; height: 60px; text-align: center; font-size: 30px; line-height: 60px; box-shadow: 2px 2px 5px #000;}
#whatsapp:hover {background:#1da851;}
#authModal {position: fixed; top:0; left:0; right:0; bottom:0; background: rgba(0,0,0,0.7); display:flex; align-items:center; justify-content:center; z-index:1000;}
#authBox {background:#fff; padding:20px; border-radius:10px; width:300px; text-align:center;}
#authBox input {width:90%; padding:6px; margin:5px 0; border:1px solid #888; border-radius:5px;}
table {width:100%; border-collapse:collapse; margin-top:10px;}
th, td {border:1px solid #ccc; padding:8px; text-align:center;}
th {background:#eee;}
</style>
</head>
<body>

<div id="horario-venta" style="background:#ff9800; color:white; text-align:center; padding:10px; font-weight:bold;">
  Horario de venta: <span id="hora-texto"></span>
</div>

<header>
  <img src="logo.jpg" alt="Logo Mexibotanas">
  <h1>Mexibotanas</h1>
</header>

<nav>
<ul>
<li><a href="Mexibotanas.html">Men칰</a></li>
<li><a href="Sugerencias.html">Sugerencias</a></li>
</ul>
</nav>

<main>
<section>
  <h2>Productos</h2>
  <div id="lista-productos"></div>
</section>

<section id="carrito">
  <h2>Carrito de pedidos</h2>
  <table>
    <thead>
      <tr><th>Producto</th><th>Cantidad</th><th>Precio</th><th>Total</th></tr>
    </thead>
    <tbody id="tabla-carrito"></tbody>
  </table>
  <p><strong>Total a pagar: $<span id="total-pagar">0.00</span></strong></p>
  <button onclick="borrarPedido()">Borrar pedido</button>
</section>

<section id="form-cliente">
  <h2>Datos del cliente</h2>
  <form id="clienteForm" onsubmit="guardarPedido(event)">
    <label for="nombre">Nombre:</label>
    <input type="text" id="nombre" required>
    <label for="celular">Celular:</label>
    <input type="text" id="celular" required>
    <label for="salon">Sal칩n:</label>
    <input type="text" id="salon" required>
    <button type="submit">Guardar pedido</button>
  </form>
</section>

<section id="historial">
  <h2>Historial de pedidos</h2>
  <div id="lista-historial"></div>
</section>
</main>

<footer>
  춸 2025 Mexibotanas Tienda de Botanas. Todos los 
  <span id="secreto" style="color:inherit; cursor:default;">derechos</span> reservados.
</footer>

<a id="whatsapp" href="https://wa.me/525651117924" target="_blank">游눫</a>

<div id="authModal">
  <div id="authBox">
    <h2>Bienvenido</h2>
    <div id="loginBox">
      <input type="text" id="loginUser" placeholder="Usuario">
      <input type="password" id="loginPass" placeholder="Contrase침a">
      <button onclick="login()">Iniciar sesi칩n</button>
      <p><a href="#" onclick="showRegister()">Registrarse</a></p>
    </div>
    <div id="registerBox" style="display:none;">
      <input type="text" id="regNombre" placeholder="Nombre completo">
      <input type="text" id="regCelular" placeholder="Celular">
      <input type="text" id="regSalon" placeholder="Sal칩n">
      <input type="text" id="regUser" placeholder="Usuario">
      <input type="password" id="regPass" placeholder="Contrase침a">
      <button onclick="register()">Guardar registro</button>
      <p><a href="#" onclick="showLogin()">Volver</a></p>
    </div>
  </div>
</div>

<script>
// === BOT칍N SECRETO ===
document.getElementById("secreto").addEventListener("dblclick", function() {
  let pass = prompt("Introduce la contrase침a:");
  if (pass === "diegoesgay") { window.location.href = "Horario.html"; }
  else if (pass !== null) { alert("Contrase침a incorrecta."); }
});

// === PRODUCTOS ===
function cargarProductosDesdeLocalStorage() {
  const contenedor = document.getElementById('lista-productos');
  contenedor.innerHTML = '';
  let productos = JSON.parse(localStorage.getItem('productos')) || [
    {id:'bonice', nombre:'Bonice', imagen:'bonice.webp', precio:5, stock:20},
    {id:'gomitas', nombre:'Gomitas', imagen:'gomitas.png', precio:10, stock:15},
    {id:'mazapan', nombre:'Mazap치n', imagen:'mazapan.webp', precio:7, stock:10},
    {id:'paletas', nombre:'Paletas de dulce', imagen:'paletas.webp', precio:3, stock:25},
    {id:'refrescos', nombre:'Refrescos', imagen:'refrescos.png', precio:15, stock:30}
  ];
  productos.forEach(p => {
    contenedor.innerHTML += `
      <div class="producto">
        <img src="${p.imagen}" alt="${p.nombre}">
        <h3>${p.nombre}</h3>
        <p>Precio: $<span class="precio" data-id="${p.id}">${p.precio.toFixed(2)}</span></p>
        <p id="stock-${p.id}">Quedan: ${p.stock}</p>
        <input type="number" id="cant-${p.id}" value="1" min="1">
        <button onclick="agregarCarrito('${p.nombre}','${p.id}')">Agregar</button>
      </div>`;
  });
}
cargarProductosDesdeLocalStorage();

let carrito = [];

function agregarCarrito(nombre,id){
  let cantidad=parseInt(document.getElementById("cant-"+id).value);
  let precio=parseFloat(document.querySelector(".precio[data-id='"+id+"']").textContent);
  let stockActual=parseInt(document.getElementById("stock-"+id).textContent.replace(/\D/g,''))||0;
  if(cantidad>stockActual){alert("No hay suficiente stock de "+nombre);return;}
  let total=precio*cantidad;
  carrito.push({producto:nombre,cantidad,precio,total,id});
  document.getElementById("stock-"+id).textContent="Quedan: "+(stockActual-cantidad);
  actualizarStockLocalStorage(id,stockActual-cantidad);
  mostrarCarrito();
  guardarCarritoTemporal();
}

function mostrarCarrito(){
  let tabla=document.getElementById("tabla-carrito");
  tabla.innerHTML=""; let total=0;
  carrito.forEach(i=>{tabla.innerHTML+=`<tr><td>${i.producto}</td><td>${i.cantidad}</td><td>$${i.precio}</td><td>$${i.total}</td></tr>`; total+=i.total;});
  document.getElementById("total-pagar").textContent=total.toFixed(2);
}

function actualizarStockLocalStorage(id,n){let p=JSON.parse(localStorage.getItem('productos'))||[];let pr=p.find(x=>x.id===id);if(pr){pr.stock=n;localStorage.setItem('productos',JSON.stringify(p));}}

function borrarPedido(){if(!carrito.length){alert("No hay productos.");return;}let p=JSON.parse(localStorage.getItem('productos'))||[];carrito.forEach(i=>{let pr=p.find(x=>x.id===i.id);if(pr){pr.stock+=i.cantidad;document.getElementById("stock-"+pr.id).textContent="Quedan: "+pr.stock;}});localStorage.setItem('productos',JSON.stringify(p));carrito=[];localStorage.removeItem("carritoTemporal");mostrarCarrito();setTimeout(()=>alert("El pedido se borr칩 correctamente."),200);}

// === GUARDAR PEDIDO ===
function guardarPedido(e){
  e.preventDefault();
  if(!carrito.length){alert("No hay productos.");return;}
  let nombre=document.getElementById("nombre").value.trim();
  let celular=document.getElementById("celular").value.trim();
  let salon=document.getElementById("salon").value.trim();
  if(!nombre||!celular||!salon){alert("Todos los campos son obligatorios.");return;}
  
  let total=carrito.reduce((s,i)=>s+i.total,0);
  let fechaHora=new Date().toLocaleString();
  
  let pedido={cliente:nombre,celular,salon,productos:[...carrito],total,estado:"Pendiente",fecha:fechaHora,nroPedido:Date.now()};
  let pedidos=JSON.parse(localStorage.getItem("pedidos"))||[];
  pedidos.push(pedido);
  localStorage.setItem("pedidos",JSON.stringify(pedidos));
  
  carrito=[];localStorage.removeItem("carritoTemporal");mostrarCarrito();mostrarHistorial();alert("Pedido guardado correctamente.");
  
  let msg=`Nuevo pedido de ${nombre}, sal칩n ${salon}, total $${total.toFixed(2)}, hora: ${fechaHora}.`;
  window.open(`https://wa.me/525651117924?text=${encodeURIComponent(msg)}`,'_blank');
}

// === MOSTRAR HISTORIAL ===
function mostrarHistorial(){
  let pedidos=JSON.parse(localStorage.getItem("pedidos"))||[];
  let lista=document.getElementById("lista-historial");
  let cliente=document.getElementById("nombre").value.trim();
  let f=pedidos.filter(p=>p.cliente===cliente);
  if(!f.length){lista.innerHTML="<p>No hay pedidos previos.</p>";return;}
  
  let html="<table><tr><th>#</th><th>Fecha/Hora</th><th>Cliente</th><th>Sal칩n</th><th>Productos</th><th>Total</th><th>Estado</th></tr>";
  f.forEach((p,i)=>{
    let productosStr=p.productos.map(pr=>`${pr.producto} x${pr.cantidad}`).join(", ");
    html+=`<tr>
      <td>${i+1}</td>
      <td>${p.fecha}</td>
      <td>${p.cliente}</td>
      <td>${p.salon}</td>
      <td>${productosStr}</td>
      <td>$${p.total.toFixed(2)}</td>
      <td>
        <select onchange="cambiarEstado(${p.nroPedido},this.value)" ${p.estado==="Completado"?"disabled":""}>
          <option value="Pendiente" ${p.estado==="Pendiente"?"selected":""}>Pendiente</option>
          <option value="Completado" ${p.estado==="Completado"?"selected":""}>Completado</option>
        </select>
      </td>
    </tr>`;
  });
  lista.innerHTML=html+"</table>";
}

function cambiarEstado(nroPedido,estado){
  let pedidos=JSON.parse(localStorage.getItem("pedidos"))||[];
  let p=pedidos.find(x=>x.nroPedido===nroPedido);
  if(!p)return;
  if(p.estado==="Completado"){
    let pass=prompt("Contrase침a admin:");
    if(pass!=="admin1234"){alert("Contrase침a incorrecta.");mostrarHistorial();return;}
  }
  p.estado=estado;
  localStorage.setItem("pedidos",JSON.stringify(pedidos));
  mostrarHistorial();
}

// === LOGIN / REGISTRO ===
function showRegister(){document.getElementById("loginBox").style.display="none";document.getElementById("registerBox").style.display="block";}
function showLogin(){document.getElementById("registerBox").style.display="none";document.getElementById("loginBox").style.display="block";}
function register(){let n=document.getElementById("regNombre").value.trim();let c=document.getElementById("regCelular").value.trim();let s=document.getElementById("regSalon").value.trim();let u=document.getElementById("regUser").value.trim();let p=document.getElementById("regPass").value.trim();if(!n||!c||!s||!u||!p){alert("Todos los campos son obligatorios.");return;}let us=JSON.parse(localStorage.getItem("usuarios"))||[];if(us.find(x=>x.user===u)){alert("Ese usuario ya existe.");return;}us.push({nombre:n,celular:c,salon:s,user:u,pass:p});localStorage.setItem("usuarios",JSON.stringify(us));alert("Registro exitoso.");showLogin();}
function login(){let u=document.getElementById("loginUser").value.trim();let p=document.getElementById("loginPass").value.trim();let us=JSON.parse(localStorage.getItem("usuarios"))||[];let x=us.find(y=>y.user===u&&y.pass===p);if(!x){alert("Usuario o contrase침a incorrectos.");return;}document.getElementById("authModal").style.display="none";sessionStorage.setItem("sesionActiva","true");sessionStorage.setItem("clienteDatos",JSON.stringify({nombre:x.nombre,celular:x.celular,salon:x.salon,user:x.user}));document.getElementById("nombre").value=x.nombre;document.getElementById("celular").value=x.celular;document.getElementById("salon").value=x.salon;mostrarHistorial();}

// === CARRITO TEMPORAL ===
function restaurarCarritoTemporal(){let c=JSON.parse(localStorage.getItem("carritoTemporal")||"[]");if(c.length>0){carrito=c;mostrarCarrito();}}
function guardarCarritoTemporal(){localStorage.setItem("carritoTemporal",JSON.stringify(carrito));}

// === INICIALIZACI칍N ===
window.onload=function(){
  if(sessionStorage.getItem("sesionActiva")==="true"){
    document.getElementById("authModal").style.display="none";
    let d=JSON.parse(sessionStorage.getItem("clienteDatos")||"{}");
    if(d.nombre){document.getElementById("nombre").value=d.nombre;document.getElementById("celular").value=d.celular;document.getElementById("salon").value=d.salon;}
    mostrarHistorial(); // <-- mostrar historial autom치ticamente al iniciar sesi칩n
  }else{
    document.getElementById("authModal").style.display="flex";
  }
  restaurarCarritoTemporal();
};

function mostrarHorario(){document.getElementById("hora-texto").textContent=localStorage.getItem("horarioVenta")||"9:00 AM - 6:00 PM";}
mostrarHorario();
</script>
</body>
</html>



